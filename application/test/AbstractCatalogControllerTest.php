<?php
require_once 'PHPUnit/Framework.php';

/**
 * Test class for AbstractCatalogController.
 * Generated by PHPUnit on 2009-06-11 at 09:36:05.
 */
class AbstractCatalogControllerTest extends PHPUnit_Framework_TestCase
{

    /**
     * Sets up the fixture, for example, opens a network connection.
     * This method is called before a test is executed.
     *
     * @access protected
     */
    protected function setUp()
    {
        $this->mcugId = new phpkit_id_URNInetId('urn:inet:middlebury.edu:catalog/MCUG');
        $this->spring2009TermId = new phpkit_id_URNInetId('urn:inet:middlebury.edu:term/200920');
        $this->fall2009TermId = new phpkit_id_URNInetId('urn:inet:middlebury.edu:term/200990');
        $this->fall2008TermId = new phpkit_id_URNInetId('urn:inet:middlebury.edu:term/200890');
        
        $this->termLookup = AbstractCatalogController::getCourseManager()->getTermLookupSessionForCatalog($this->mcugId);
        $this->topicLookup = AbstractCatalogController::getCourseManager()->getTopicLookupSessionForCatalog($this->mcugId);
    }

    /**
     * Tears down the fixture, for example, closes a network connection.
     * This method is called after a test is executed.
     *
     * @access protected
     */
    protected function tearDown()
    {
    }

    /**
     * 
     */
    public function testGetCourseManager()
    {
        $this->assertType('osid_course_CourseManager', AbstractCatalogController::getCourseManager());
    }

    /**
     * 
     */
    public function testGetRuntimeManager()
    {
        $this->assertType('osid_OsidRuntimeManager', AbstractCatalogController::getRuntimeManager());
    }

    /**
     * 
     */
    public function testGetOsidIdFromString()
    {
    	$id = new phpkit_id_Id('example.edu', 'urn', '123456789/abcd');
    	$idString = AbstractCatalogController::getStringFromOsidId($id);
    	
    	$newId = AbstractCatalogController::getOsidIdFromString($idString);
        $this->assertType('osid_id_Id', $newId);
        $this->assertTrue($id->isEqual($newId));
    }

    /**
     * 
     */
    public function testGetStringFromOsidId()
    {
    	$id = new phpkit_id_Id('example.edu', 'urn', '123456789/abcd');
    	$idString = AbstractCatalogController::getStringFromOsidId($id);
        $this->assertType('string', $idString);
        
        $newId = AbstractCatalogController::getOsidIdFromString($idString);
        $this->assertEquals($idString, AbstractCatalogController::getStringFromOsidId($newId));
    }

    /**
     * 
     */
    public function testTopicListAsArray()
    {
        $topics = $this->topicLookup->getTopics();
        $numTopics = $topics->available();
        $topicArray = AbstractCatalogController::topicListAsArray($topics);
        $this->assertType('array', $topicArray);
        $this->assertEquals($numTopics, count($topicArray));
        $this->assertType('osid_course_Topic', $topicArray[0]);
    }

    /**
     * 
     */
    public function testFilterTopicsByType()
    {
        $topics = $this->topicLookup->getTopics();
        $numTopics = $topics->available();
        $topicArray = AbstractCatalogController::topicListAsArray($topics);
        
        $subjectType = new phpkit_type_URNInetType("urn:inet:middlebury.edu:genera:topic/subject");

        $filteredTopics = AbstractCatalogController::filterTopicsByType($topicArray, $subjectType);
        $this->assertType('array', $filteredTopics);
        $this->assertLessThan($numTopics, count($filteredTopics));
        $this->assertEquals(3, count($filteredTopics));
        $this->assertType('osid_course_Topic', $filteredTopics[0]);
    }

    /**
     * 
     */
    public function testGetTimeString()
    {
        $this->assertEquals('00:00', AbstractCatalogController::getTimeString(0));
        $this->assertEquals('08:33', AbstractCatalogController::getTimeString(30780));
        $this->assertEquals('18:21', AbstractCatalogController::getTimeString(66060));
        $this->assertEquals('24:00', AbstractCatalogController::getTimeString(86400));   
    }

    /**
     * 
     */
    public function testGetCurrentTermId()
    {
        $this->assertType('osid_id_Id', AbstractCatalogController::getCurrentTermId($this->mcugId));
    }

    /**
     * 
     */
    public function testGetClosestTermId()
    {
        $testDate = new DateTime('2009-09-30');
        $terms = $this->termLookup->getTerms();
        $closestTermId = AbstractCatalogController::getClosestTermId($terms, $testDate);
        $this->assertTrue($closestTermId->isEqual($this->fall2009TermId));
        
    }
    
    /**
     * 
     */
    public function testGetClosestNonOverlappingTermIdA()
    {
        $testDate = new DateTime('2009-08-15');
        $terms = $this->termLookup->getTerms();
        $closestTermId = AbstractCatalogController::getClosestTermId($terms, $testDate);
        $this->assertTrue($closestTermId->isEqual($this->fall2009TermId));
        
    }
    
    /**
     * 
     */
    public function testGetClosestNonOverlappingTermIdB()
    {
        $testDate = new DateTime('2009-06-15');
        $terms = $this->termLookup->getTerms();
        $closestTermId = AbstractCatalogController::getClosestTermId($terms, $testDate);
        $this->assertTrue($closestTermId->isEqual($this->spring2009TermId));
        
    }
    
    /**
     * 
     */
    public function testGetClosestTermIdBeyondRange()
    {
        $testDate = new DateTime('2020-01-01');
        $terms = $this->termLookup->getTerms();
        $closestTermId = AbstractCatalogController::getClosestTermId($terms, $testDate);
        $this->assertTrue($closestTermId->isEqual($this->fall2009TermId));
        
    }
}
?>
