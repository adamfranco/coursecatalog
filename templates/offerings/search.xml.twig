<?xml version="1.0" encoding="utf-8" ?>
<rss version="2.0" xmlns:catalog="http://www.middlebury.edu/course_catalog">
    <channel>
        <title>{{ title }}</title>
        <link>{{ feedLink }}</link>
        <description></description>
        <lastBuildDate>{{ 'now' | date('r') }}</lastBuildDate>
        <generator>Course Catalog</generator>
        <docs>http://blogs.law.harvard.edu/tech/rss</docs>
    {% if previousTerm %}{{ include('partials/term.xml.twig', {term: previousTerm, key: 'previous_term'}) }}{% endif %}
    {% if term %}{{ include('partials/term.xml.twig', {term: term, key: 'chosen_term'}) }}{% endif %}
    {% if nextTerm %}{{ include('partials/term.xml.twig', {term: nextTerm, key: 'next_term'}) }}{% endif %}
{% if terms %}
        <catalog:all_terms>
        {% for t in terms %}
            {{ include('partials/term.xml.twig', {term: t, key: 'term'}) }}
        {% endfor %}
        </catalog:all_terms>
{% endif %}

{% for section in sections %}
        <item>
            <title>{{ section.displayname }}</title>
            <link>{{ url('view_offering', {'id': osidIdToString(section.id)}) }}</link>
            <description><![CDATA[{{ section.description|raw }}]]></description>
            <catalog:title>{{ section.title }}</catalog:title>
            <catalog:id>{{ osidIdToString(section.id) }}</catalog:id>
    {%~ if is_primary is not null %}
            <catalog:enrollable>{{ is_primary ? 'true':'false' }}</catalog:enrollable>
    {% endif ~%}
{%- if alternates is not empty %}
{%- for alternate in alternates %}
        <catalog:alternate id="{{ osidIdToString(alternate.id) }}" href="{{ url('view_offering', {id: osidIdToString(alternate.id), term: osidIdToString(term.id)}) }}" is_primary="{{ alternate.is_primary ? 'true':'false' }}">{{ alternate.displayname }}</catalog:alternate>
{% endfor ~%}
{% endif %}
            <catalog:genustype type="{{ osidTypeToString(offering.genustype) }}" id="{{ osidTypeToString(offering.genustype) }}">{{ offering.genustype.displayname }}</catalog:genustype>
            {{ include('partials/term.xml.twig', {term: section.term, key: 'term'}) }}

{%- for topic in subjectTopics %}
            <catalog:topic type="{{ osidTypeToString(topic.genustype) }}" id="{{ osidIdToString(topic.id) }}" href='{{ url('view_topic', {topic: osidIdToString(topic.id), term: osidIdToString(term.id)}) }}'>{{ topic.displayname }}</catalog:topic>
{% endfor %}
{%- for topic in departmentTopics %}
            <catalog:topic type="{{ osidTypeToString(topic.genustype) }}" id="{{ osidIdToString(topic.id) }}" href='{{ url('view_topic', {topic: osidIdToString(topic.id), term: osidIdToString(term.id)}) }}'>{{ topic.displayname }}</catalog:topic>
{% endfor %}
{%- for topic in divisionTopics %}
            <catalog:topic type="{{ osidTypeToString(topic.genustype) }}" id="{{ osidIdToString(topic.id) }}" href='{{ url('view_topic', {topic: osidIdToString(topic.id), term: osidIdToString(term.id)}) }}'>{{ topic.displayname }}</catalog:topic>
{% endfor %}
{%- for topic in requirementTopics %}
            <catalog:topic type="{{ osidTypeToString(topic.genustype) }}" id="{{ osidIdToString(topic.id) }}" href='{{ url('view_topic', {topic: osidIdToString(topic.id), term: osidIdToString(term.id)}) }}'>{{ topic.displayname }}</catalog:topic>
{% endfor %}
{%- if blockTopics is not empty %}
    {%- for topic in blockTopics %}
            <catalog:topic type="{{ osidTypeToString(topic.genustype) }}" id="{{ osidIdToString(topic.id) }}" href='{{ url('view_topic', {topic: osidIdToString(topic.id), term: osidIdToString(term.id)}) }}'>{{ topic.displayname }}</catalog:topic>
    {% endfor %}
{% endif %}
{%- if levelTopics is not empty %}
    {%- for topic in levelTopics %}
            <catalog:topic type="{{ osidTypeToString(topic.genustype) }}" id="{{ osidIdToString(topic.id) }}" href='{{ url('view_topic', {topic: osidIdToString(topic.id), term: osidIdToString(term.id)}) }}'>{{ topic.displayname }}</catalog:topic>
    {% endfor ~%}
{% endif %}
{%- if instructors is not null %}
    {%- for instructor in instructors %}
            <catalog:instructor id="{{ osidIdToString(instructor.id) }}" href="{{ url('view_resource', {resource: osidIdToString(instructor.id), term: osidIdToString(term.id)}) }}">{{ instructor.displayname }}</catalog:instructor>
    {% endfor %}
{% endif %}
{%- if location %}
            <catalog:location id="{{ osidIdToString(location.id) }}" href="{{ url('view_resource', {resource: osidIdToString(location.id), term: osidIdToString(term.id)}) }}">{{ location.displayname }}</catalog:location>
{% elseif offering.locationinfo %}
            <catalog:location>{{ offering.locationinfo }}</catalog:location>
{% endif %}
            <catalog:schedule{% if weekly_schedule %} meeting_start_date="{{ weekly_schedule.meetingstartdate|date('Y-m-d') }}" meeting_end_date="{{ weekly_schedule.meetingenddate|date('Y-m-d') }}"{% endif %}>{{ offering.scheduleinfo|raw }}</catalog:schedule>
{% for property in properties %}
            <catalog:property>
                <catalog:display_name>{{ property.displayname }}</catalog:display_name>
                <catalog:display_label>{{ property.displaylabel}}</catalog:display_label>
                <catalog:description><![CDATA[{{ property.description }}]]></catalog:description>
                <catalog:value><![CDATA[{{ property.value }}]]></catalog:value>
            </catalog:property>
{% endfor %}
{% endfor %}
        </item>
    </channel>
</rss>
